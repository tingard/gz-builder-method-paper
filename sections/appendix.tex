% !TEX root = ../main.tex
\documentclass[../main.tex]{subfiles}
\begin{document}
\section{Technical overview of the Zooniverse project}

The custom code allowing in-browser galaxy photometric modelling had to be incorporated into the existing Zooniverse website front-end codebase\footnote{\url{http://github.com/zooniverse/Panoptes-Front-End}}. This front-end was written using Facebook's \textsc{React}\footnote{\url{http://reactjs.org}} JavaScript library, which uses a declarative, component-based framework to piece together an interactive webpage from a series of building blocks.

Traditionally the way Zooniverse projects operate is fairly linear - with researchers uploading data, generally in the form of one or more images. These ``subjects`` are then presented to volunteers, who are asked to perform a series of relatively simple tasks to extract meaningful information useful to the project's science case. Exceptions to this workflow exist, such as the Galaxy Zoo mergers project \citep{Holincheck2016:1604.00435v1}, but not inside the current Zooniverse web platform.

The Galaxy Builder project breaks the above pattern in that two of the images a volunteer is shown vary depending on their in-progress classification. This seemingly small change results in a significant amount of code restructuring, which was not anticipated at the onset of the project.

Initially, rendering was performed on the CPU, simply using JavaScript. As JavaScript compilers have become increasingly advanced (approaching numpy-level speeds for many mathematical tasks), this option seemed viable for some time. However, the requirement of a smooth user-interface and near-instantaneous feedback on changes for volunteer prompted a change to GPU rendering using WebGL. For convenience, the \textsc{regl}\footnote{\url{http://regl.party/}} package was selected for use.

\section{Mathematical description of the poly-line separation measure}
\label{appendix:clusteringMaths}

First, define a poly-line containing $n$ 2D cartesian coordinates (vertices) as

\begin{equation}
A: \{i \in \mathbb{N};\;i<n\} \longrightarrow \mathbb{R}
^2\end{equation}

We also define a function, $t$, which calculates how far a point $\vec{p}$ is along the line between two other points ($\vec{v}$ and $\vec{w}$):

\begin{equation}
t(\vec{p},\,\vec{v},\,\vec{w}) \equiv \frac{(\vec{p} - \vec{v})\cdot(\vec{v} - \vec{w})}{|\vec{w} - \vec{v}|^2}.
\end{equation}

The minimum distance from $\vec{p}$ to the line segment between $\vec{v}$ and $\vec{w}$ is given by

\begin{equation}
d(\vec{p},\,\vec{v},\,\vec{w}) = \|\left(\vec{v} + \mathrm{min}(\mathrm{max}(t(\vec{p},\,\vec{v},\,\vec{w}),\, 0),\, 1)\;(\vec{w} - \vec{v})\right) - \vec{p}\|
\end{equation}

We then define a ``squared distance'' from the poly-line $A$ (containing $n$ vertices) to the poly-line $B$ (containing $m$ vertices):

\begin{equation}
D(A,\,B) \equiv \sum_{i = 0}^{n} \mathrm{min}\{j \in \mathbb{N}_0,\, j < m;\; d(A_i,\, B_j,\, B_{j+1})^2\}.
\end{equation}

The choice to square the distances and penalize large deviations from other lines was a data-driven choice to improve the results of clustering.

Finally, we define our separation measure between two drawn poly-lines as

\begin{equation}
distance(A,\,B) \equiv D(A,\,B) + D(B,\,A).
\end{equation}

\comment{Some figures showing how this distance is calculed would be useful}

\section{Example resulting splines from Galaxy Builder}
\label{appendix:exampleSplines}

\begin{figure}
  \includegraphics[width=8cm]{images/montage-subject-21096891.jpg}
  \caption{An example of the resulting spiral classifications for a galaxy in the Galaxy Builder sample}
\end{figure}
\end{document}

\section{Model Rendering Profile}

Standard S\`ersic \comment{citation}:
\begin{equation}
  I(R) = I_e \exp\left(-b_n\left[\left(\frac{R}{R_e}\right)^{1/n} - 1\right]\right)
\end{equation}

As implemented in Galaxy Builder (for a galaxy with axis ratio $E$, drawn isophotal major axis $r_e$, boxyness $c$ and S\`ersic index $n$):

\begin{equation}
  I(R) = \frac{I_0}{2} \exp\left(-b_n\left[D^{1/n} - 1\right]\right),
\end{equation}

\noindent
where

\begin{equation}
  \begin{aligned}
    D &= 3\sqrt{\left(\frac{E}{r_e}\right)^c|x' - \mu_x|^c + \left(\frac{1}{r_e}\right)^c|y'-\mu_y|^c} \\
      &= \frac{3}{r_e^{c/2}}\sqrt{E^c|x' - \mu_x|^c + |y'-\mu_y|^c}
  \end{aligned}
\end{equation}

\noindent
and

\begin{equation}
  \begin{pmatrix}x'\\y'\end{pmatrix} =
    \begin{pmatrix}\cos\phi & -\sin\phi\\\sin\phi & \cos\phi\end{pmatrix}\begin{pmatrix}x\\y\end{pmatrix}
      + \vec{\mu}
      - \begin{pmatrix}\cos\phi & -\sin\phi\\\sin\phi & \cos\phi\end{pmatrix} \vec{\mu}.
\end{equation}

\noindent

Therefore the effective radius is given by

\begin{equation}
  R_e = \frac{r_e^{c/2}}{3}
\end{equation}
